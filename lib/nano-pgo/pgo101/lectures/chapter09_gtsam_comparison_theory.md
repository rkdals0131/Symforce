# PGO 101 - Chapter 9 이론 강의: 전문가의 도구, GTSAM 파헤치기

**강의 목표:** 이 강의를 마치면, 여러분은 우리가 직접 만든 교육용 `nano-pgo` 옵티마이저와 실제 산업계 및 연구에서 널리 쓰이는 전문가용 라이브러리인 **GTSAM**의 차이점을 명확히 이해하게 됩니다. GTSAM의 핵심 설계 철학인 **팩터 그래프 (Factor Graph)** 를 배우고, 언제 `nano-pgo`와 같은 간단한 구현을 사용하고 언제 GTSAM과 같은 강력한 도구를 사용해야 하는지 판단할 수 있는 능력을 갖추게 됩니다. 이 강의는 `chapter09_gtsam_comparison.ipynb` 실습에서 GTSAM을 직접 사용해보기 위한 개념적 토대를 마련합니다.

---

## 1. 왜 전문가용 라이브러리를 배워야 하는가?

지금까지 우리는 `nano-pgo`를 직접 만들며 Pose Graph Optimization의 내부 동작 원리를 깊이 있게 탐구했습니다. 이는 마치 자동차의 엔진과 변속기 원리를 배우기 위해 직접 카트를 조립해보는 것과 같습니다. 이제 우리는 잘 만들어진 상용차, 즉 **GTSAM (Georgia Tech Smoothing and Mapping)** 이라는 전문가용 도구를 살펴볼 차례입니다.

*   **`nano-pgo` (교육용 도구)**: 내부 구조가 투명하여 학습에 최적화되어 있습니다. 원리를 이해하는 데는 최고입니다.
*   **GTSAM (상용/연구용 도구)**: 수많은 전문가들이 수년간 개발하여 성능, 안정성, 기능 면에서 최고 수준으로 최적화되어 있습니다.

전문가용 라이브러리를 배우는 것은, 우리가 배운 원리가 실제 세계에서 어떻게 구현되고 확장되는지 이해하고, 더 크고 복잡한 문제를 해결할 수 있는 능력을 갖추기 위함입니다.

## 2. 팩터 그래프 (Factor Graph): GTSAM의 핵심 설계 사상

GTSAM은 최적화 문제를 **팩터 그래프 (Factor Graph)** 라는 매우 유연하고 확장성 있는 구조로 표현합니다. 이는 우리가 배웠던 그래프 표현을 한 단계 더 추상화한 것입니다.

> 💡 **핵심 비유**: 팩터 그래프는 최적화 문제를 위한 '레고 (LEGO)' 세트와 같습니다.
> - **변수 (Variables)**: 우리가 만들고 싶은 모델의 '부품' (예: 로봇의 자세, 랜드마크의 위치).
> - **팩터 (Factors)**: 부품들을 연결하는 '규칙' 또는 '설명서' (예: 두 포즈 사이의 상대 거리, 카메라에 포착된 ���드마크의 픽셀 위치).

### 팩터 그래프의 구성 요소

*   **변수 (Variables)**: 우리가 추정하고자 하는 미지의 값들입니다.
    *   `Pose2`, `Pose3`: 2D, 3D 자세
    *   `Point2`, `Point3`: 2D, 3D 랜드마크 위치
    *   `Camera`, `Cal3_S2`: 카메라 자세 및 캘리브레이션
*   **팩터 (Factors)**: 변수들 간의 수학적 제약 조건을 나타냅니다. 모든 센서 측정값은 팩터로 변환됩니다.
    *   `PriorFactor`: 하나의 변수에 대한 절대적인 제약 (예: 시작점 고정).
    *   `BetweenFactor`: 두 변수 사이의 상대적인 제약 (예: 오도메트리 측정값).
    *   `BearingRangeFactor`: 포즈와 랜드마크 사이의 방향/거리 측정값.
*   **노이즈 모델 (Noise Model)**: 각 팩터 (측정값) 가 얼마나 불확실한지를 정의합니다. 이는 최적화 시 가중치 역할을 합니다.

이러한 모듈식 구조 덕분에, 어떤 복잡한 센서 조합이라도 필요한 변수와 팩터를 레고처럼 조립하여 쉽게 최적화 문제를 구성할 수 있습니다.

### [실습 연결]
`chapter09` 노트북의 **1. Factor Graph Concepts in Detail** 섹션에서는, GTSAM의 파이썬 API를 사용하여 `NonlinearFactorGraph` 에 변수와 팩터를 직접 추가하며 팩터 그래프를 구성하는 방법을 실습합니다.

---

## 3. GTSAM의 강력한 기능들

GTSAM은 `nano-pgo`에는 없는, 실제 SLAM 시스템을 위한 강력한 기능들을 제공합니다.

*   **다양한 최적화 알고리즘**:
    *   **Gauss-Newton**: 빠르지만 때로는 불안정.
    *   **Levenberg-Marquardt (LM)**: 안정성과 속도의 균형. 대부분의 경우 좋은 선택.
    *   **Dogleg**: LM과 유사하지만 다른 신뢰 영역 (Trust Region) 전략 사용.
*   **증분 최적화 (iSAM2)**:
    *   실시간 SLAM을 위한 GTSAM의 핵심 기술입니다.
    *   새로운 측정값이 추가될 때마다 전체 그래프를 다시 푸는 대신, **변화가 있는 부분만 지능적으로 업데이트**하여 일정한 계산 속도를 보장합니다.
*   **불확실성 정량화 (Marginal Covariance)**:
    *   최적화가 끝난 후, "그래서 이 결과가 얼마나 정확한가?"라는 질문에 답을 줍니다.
    *   각 변수의 공분산 (Covariance) 을 계산하여, 추정치가 얼마나 불확실한지를 정량적으로 알 수 있습니다. 이는 안전한 경로 계획이나 능동적 탐사 (Active SLAM) 에 필수적입니다.

### [실습 연결]
`chapter09` 노트북의 **2. GTSAM Optimization Execution** 과 **4. GTSAM Advanced Features** 섹션에서는, 다양한 옵티마이저를 사용해보고, iSAM2와 ��분산 계산을 위한 API를 간략하게 살펴봅니다.