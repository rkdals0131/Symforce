# PGO 101 - Chapter 7 이론 강의: 최적화의 첫 단추 - 회전 초기화

**강의 목표:** 이 강의를 마치면, 여러분은 Pose Graph Optimization의 성공 여부를 결정하는 매우 중요한 첫 단계인 **초기값 설정 (Initialization)** 의 중요성을 이해하게 됩니다. 특히, 위치보다 회전 오차에 더 민감한 최적화 문제의 특성을 파악하고, **회전 동기화 (Rotation Synchronization)** 라는 문제를 푸는 강력한 기법인 **코달 완화 (Chordal Relaxation)** 의 원리를 설명할 수 있게 됩니다. 이 강의는 `chapter07_rotation_initialization_chordal.ipynb` 실습에서 좋은 초기값을 구하는 알고리즘을 구현하기 위한 이론적 기반을 제공합니다.

---

## 1. 좋은 초기값, 왜 중요한가?

Pose Graph Optimization은 비용 함수라는 복잡한 지형에서 가장 낮은 지점 (최적해) 을 찾는 과정과 같습니다. 이 지형은 여러 개의 골짜기 (local minima) 와 단 하나의 가장 깊은 골짜기 (global minimum) 로 이루어져 있습니다.

*   **나쁜 초기값**: 탐색��� 엉뚱한 산봉우리에서 시작하는 것과 같습니다. 알고리즘은 가장 가까운 골짜기, 즉 **지역 최적해 (local minimum)** 에 빠져버리고, 더 깊은 진짜 골짜기를 찾지 못할 수 있습니다. 최악의 경우, 아예 수렴하지 못하고 발산할 수도 있습니다.
*   **좋은 초기값**: 탐색을 우리가 찾고자 하는 가장 깊은 골짜기 근처에서 시작하게 해줍니다. 이는 **빠른 수렴**과 **더 정확한 해**를 보장합니다.

특히 SLAM 문제에서는 위치 (translation) 오차보다 **회전 (rotation) 오차**가 전체 비용 함수에 훨씬 더 큰 영향을 미칩니다. 따라서, 전체 최적화를 시작하기 전에 **모든 포즈의 회전값을 먼저 정확하게 초기화**하는 것이 매우 효과적인 전략입니다.

## 2. 회전 동기화 (Rotation Synchronization)

이것이 바로 회전 초기화 문제의 공식적인 명칭입니다.

> **문제 정의**: 포즈 그래프에 있는 모든 상대 회전 측정값 ($R_{ij}$) 들이 주어졌을 때, 이 측정값들을 전역적으로 가장 잘 만족시키는 각 포즈의 절대 회전 ($R_i$) 을 찾는 문제입니다.

수학적으로는, 모든 간선 (edge) 에 대해 $R_j \approx R_i R_{ij}$ 를 만족하는 $R_i$ 들의 집합을 찾는 것입니다.

> 💡 **��심 비유**: 여러 명의 사람들이 각자 나침반을 들고 흩어져 있다고 상상해보세요. 아무도 북쪽이 어디인지 모르지만, 각자는 주변 사람의 나침반 바늘이 자신을 기준으로 몇 도 돌아가 있는지는 알고 있습니다. 회전 동기화는 이 상대적인 정보들만을 모아서, 모든 사람의 나침반이 가리키는 절대적인 방향 (북쪽) 을 알아내는 과정과 같습니다.

## 3. 코달 완화 (Chordal Relaxation): 어려운 제약을 푸는 영리한 방법

회전 동기화 문제는 각 회전 행렬 $R_i$ 가 $SO(3)$ 그룹에 속해야 한다는 ($R^T R = I, \det(R)=1$) 까다로운 **비선형 제약 조건** 때문에 풀기 어렵습니다.

**코달 완화 (Chordal Relaxation)** 는 이 어려운 문제를 다음과 같은 세 단계의 영리한 트릭으로 해결합니다.

1.  **완화 (Relaxation)**: "모든 $R_i$ 는 반드시 회전 행렬이어야 한다"는 어려운 제약을, **"모든 $R_i$ 는 그냥 일반적인 3x3 행렬이다"** 라는 매우 느슨한 제약으로 잠시 **완화**합니다.
2.  **선형 최적화 (Linear Optimization)**: 제약이 완화된 문제는 더 이상 비선형이 아닌, 간단한 **선형 최소 제곱 문제**가 됩니다. 이 문제는 **고유값 분해 (eigenvalue decomposition)** 라는 강력한 선형대수 기법을 통해 전역 최적해를 한 번에, 그리고 매우 효율적으로 찾을 수 있습니다.
3.  **투영 (Projection)**: 2단계에서 찾은 '일반 3x3 행렬'들은 실제 회전 행렬이 아닐 수 있습니다. 따라서, 각 행렬을 그것과 **가장 가까운 (nearest) '진짜' 회전 행렬**로 다시 **투영**시켜줍니다. 이 과정은 **특이값 분해 (SVD)** 를 통해 간단하게 수행할 수 있습니다.

이 "어려운 문제 → 쉬운 문제로 변환하여 풀기 → 다시 원래 문제의 해로 변환"하는 접근법은 매우 빠르고, 놀라울 정도로 정확한 회전 초기값을 제공합니다.

### [실습 연결]
`chapter07` 노트북에서는 이 코달 완화 알고리즘을 단계별로 직접 구현합니다.
- **3. Chordal Relaxation**: 모든 상대 회전으로부터 거대한 Q 행렬을 구축하고, `scipy.sparse.linalg.eigsh` 를 사용해 고유값 문제를 풀어 회전의 초기값을 구합니다.
- **5. Testing Rotation Synchronization**: 무작위로 생성된 그래프에서 코달 완화의 성능을 테스트하고, 그 정확도를 평가합니다.
- **8. Application to Full Pose Graph Optimization**: 코달 완화로 얻은 회전 초기값을 사용하여 전체 포즈 그래프 (위치+회전) 의 초기값을 설정하고, 이것이 최적화에 얼마나 큰 도움이 되는지 확인합니다.